{% assign prefix = trmnl.plugin_settings.custom_fields_values.Weather_station %}
<!-- This is to deal with the parsing of variables TRMNL does -->
<!-- Thanks to Github user StrandmonYellow for suggesting this. I made using the raingraph a selectable option -->
{% assign view_mode = trmnl.plugin_settings.custom_fields_values.Raingraph
  | default: 'forecast'
  | downcase
  | strip %}
<!-- quick flag for switching between direct weather station selection and using coordinates for backwards compatability -->
{% assign ws_raw = trmnl.plugin_settings.custom_fields_values.Weather_station | default: 'weather' %}
{% assign ws_norm = ws_raw | replace: '_', ' ' | strip | downcase %}
{% assign use_coords = false %}
{% if ws_norm == 'use coordinates' %}
  {% assign use_coords = true %}
{% endif %}
<!-- TRMNL's jinja uses integer math so we need a scale factor for the lattitude and londitude
Please don't edit this or you will have to edit the stations lists as well-->
{% assign SCALE = 1000 %}

{% assign lat_raw = trmnl.plugin_settings.custom_fields_values.Latitude  | default: '' | replace: ',', '.' | strip %}
{% assign lon_raw = trmnl.plugin_settings.custom_fields_values.Longitude | default: '' | replace: ',', '.' | strip %}
{% assign has_user_coords = true %}
{% if lat_raw == '' or lon_raw == '' %}
  {% assign has_user_coords = false %}
{% endif %}
<!-- Users can really mess with inputs. This forces it to be a number, preserving
floats using the scale we defined above, and swaps the lat-lon if we see a mistake-->
{% assign lat_parts = lat_raw | split: '.' %}
{% assign lat_ip = lat_parts[0] | plus: 0 %}
{% assign lat_fp = '0' %}
{% if lat_parts.size > 1 %}{% assign lat_fp = lat_parts[1] %}{% endif %}
{% assign lat_fp3 = lat_fp | append: '000' | slice: 0, 3 | plus: 0 %}
{% assign user_lat_i = lat_ip | times: SCALE | plus: lat_fp3 %}

{% assign lon_parts = lon_raw | split: '.' %}
{% assign lon_ip = lon_parts[0] | plus: 0 %}
{% assign lon_fp = '0' %}
{% if lon_parts.size > 1 %}{% assign lon_fp = lon_parts[1] %}{% endif %}
{% assign lon_fp3 = lon_fp | append: '000' | slice: 0, 3 | plus: 0 %}
{% assign user_lon_i = lon_ip | times: SCALE | plus: lon_fp3 %}

{% if has_user_coords and user_lat_i < 20000 and user_lon_i > 20000 %}
  {% assign _tmp = user_lat_i %}
  {% assign user_lat_i = user_lon_i %}
  {% assign user_lon_i = _tmp %}

  {% assign _tmp2 = lat_raw %}
  {% assign lat_raw = lon_raw %}
  {% assign lon_raw = _tmp2 %}
{% endif %}

{% capture stations_json %}
[
  {"stationname":"meetstation arcen","lat":"51.5","lon":"6.2","lat_i":51500,"lon_i":6200},
  {"stationname":"meetstation arnhem","lat":"52.07","lon":"5.88","lat_i":52070,"lon_i":5880},
  {"stationname":"meetstation berkhout","lat":"52.65","lon":"4.98","lat_i":52650,"lon_i":4980},
  {"stationname":"meetstation de bilt","lat":"52.1","lon":"5.18","lat_i":52100,"lon_i":5180},
  {"stationname":"meetstation den helder","lat":"52.92","lon":"4.78","lat_i":52920,"lon_i":4780},
  {"stationname":"meetstation eindhoven","lat":"51.45","lon":"5.42","lat_i":51450,"lon_i":5420},
  {"stationname":"meetstation ell","lat":"51.2","lon":"5.77","lat_i":51200,"lon_i":5770},
  {"stationname":"meetstation gilze rijen","lat":"51.57","lon":"4.93","lat_i":51570,"lon_i":4930},
  {"stationname":"meetstation goes","lat":"51.53","lon":"3.9","lat_i":51530,"lon_i":3900},
  {"stationname":"meetstation groenlo-hupsel","lat":"52.07","lon":"6.65","lat_i":52070,"lon_i":6650},
  {"stationname":"meetstation groningen","lat":"53.13","lon":"6.58","lat_i":53130,"lon_i":6580},
  {"stationname":"meetstation heino","lat":"52.43","lon":"6.27","lat_i":52430,"lon_i":6270},
  {"stationname":"meetstation herwijnen","lat":"51.87","lon":"5.15","lat_i":51870,"lon_i":5150},
  {"stationname":"meetstation hoek van holland","lat":"51.98","lon":"4.1","lat_i":51980,"lon_i":4100},
  {"stationname":"meetstation hoogeveen","lat":"52.73","lon":"6.52","lat_i":52730,"lon_i":6520},
  {"stationname":"meetstation hoorn terschelling","lat":"53.38","lon":"5.35","lat_i":53380,"lon_i":5350},
  {"stationname":"meetstation houtribdijk","lat":"52.65","lon":"5.4","lat_i":52650,"lon_i":5400},
  {"stationname":"meetstation ijmuiden","lat":"52.47","lon":"4.57","lat_i":52470,"lon_i":4570},
  {"stationname":"meetstation lauwersoog","lat":"53.42","lon":"6.2","lat_i":53420,"lon_i":6200},
  {"stationname":"meetstation leeuwarden","lat":"53.22","lon":"5.77","lat_i":53220,"lon_i":5770},
  {"stationname":"meetstation lelystad","lat":"52.45","lon":"5.53","lat_i":52450,"lon_i":5530},
  {"stationname":"meetstation lopik-cabauw","lat":"51.97","lon":"4.93","lat_i":51970,"lon_i":4930},
  {"stationname":"meetstation maastricht","lat":"50.92","lon":"5.78","lat_i":50920,"lon_i":5780},
  {"stationname":"meetstation marknesse","lat":"52.7","lon":"5.88","lat_i":52700,"lon_i":5880},
  {"stationname":"meetstation nieuw beerta","lat":"53.2","lon":"7.15","lat_i":53200,"lon_i":7150},
  {"stationname":"meetstation rotterdam","lat":"51.95","lon":"4.45","lat_i":51950,"lon_i":4450},
  {"stationname":"meetstation rotterdam geulhaven","lat":"51.88","lon":"4.32","lat_i":51880,"lon_i":4320},
  {"stationname":"meetstation schiphol","lat":"52.3","lon":"4.77","lat_i":52300,"lon_i":4770},
  {"stationname":"meetstation stavoren","lat":"52.88","lon":"5.38","lat_i":52880,"lon_i":5380},
  {"stationname":"meetstation texelhors","lat":"53","lon":"4.75","lat_i":53000,"lon_i":4750},
  {"stationname":"meetstation twente","lat":"52.27","lon":"6.9","lat_i":52270,"lon_i":6900},
  {"stationname":"meetstation vlieland","lat":"53.25","lon":"4.92","lat_i":53250,"lon_i":4920},
  {"stationname":"meetstation vlissingen","lat":"51.45","lon":"3.6","lat_i":51450,"lon_i":3600},
  {"stationname":"meetstation volkel","lat":"51.65","lon":"5.7","lat_i":51650,"lon_i":5700},
  {"stationname":"meetstation voorschoten","lat":"52.12","lon":"4.43","lat_i":52120,"lon_i":4430},
  {"stationname":"meetstation westdorpe","lat":"51.23","lon":"3.83","lat_i":51230,"lon_i":3830},
  {"stationname":"meetstation wijdenes","lat":"52.63","lon":"5.17","lat_i":52630,"lon_i":5170},
  {"stationname":"meetstation wijk aan zee","lat":"52.5","lon":"4.6","lat_i":52500,"lon_i":4600},
  {"stationname":"meetstation woensdrecht","lat":"51.45","lon":"4.33","lat_i":51450,"lon_i":4330},
  {"stationname":"meetstation zeeplatform f-3","lat":"54.85","lon":"4.73","lat_i":54850,"lon_i":4730}
]
{% endcapture %}
{% assign stations = stations_json | strip | parse_json %}
{% assign selected_station = ws_raw | replace: "_", " " | downcase %}
{% assign best_station = nil %}
{% assign best_dist2  = nil %}

{% if use_coords %}
  {% if has_user_coords %}
    {% for s in stations %}

      {%- comment -%}Force numeric coercion (defensive){%- endcomment -%}
      {% assign s_lat_i = s.lat_i | plus: 0 %}
      {% assign s_lon_i = s.lon_i | plus: 0 %}

      {% assign dlat  = s_lat_i | minus: user_lat_i %}
      {% assign dlon  = s_lon_i | minus: user_lon_i %}

      {% assign dlat2 = dlat | times: dlat %}
      {% assign dlon2 = dlon | times: dlon %}
      {% assign dist2 = dlat2 | plus: dlon2 %}

      {% if best_dist2 == nil or dist2 <= best_dist2 %}
        {% assign best_dist2 = dist2 %}
        {% assign best_station = s %}
      {% endif %}

    {% endfor %}
<!-- I use different default stations here for debugging reasons -->
    {% if best_station != nil %}
      {% assign selected_station = best_station.stationname %}
    {% else %}
        {% assign selected_station = 'meetstation eindhoven' %}
    {% endif %}
  {% else %}
    {% assign selected_station = 'meetstation twente' %}
  {% endif %}
{% endif %}

{% if selected_station == nil or selected_station == '' %}
  {% assign selected_station = 'meetstation eindhoven' %}
{% endif %}

{% assign lopik = nil %}
{% assign selected_station_lc = selected_station | downcase %}
{% for m in actual.stationmeasurements %}
  {% assign m_lc = m.stationname | downcase %}
  {% if m_lc == selected_station_lc %}
    {% assign lopik = m %}
    {% break %}
  {% endif %}
{% endfor %}
{% if lopik == nil %}
  {% assign lopik = actual.stationmeasurements | first %}
{% endif %}
<!-- If no coordinates are supplied I will use the raingraph from the weather station itself -->
{%- assign station_obj = nil -%}
{%- if best_station != nil -%}
  {%- assign station_obj = best_station -%}
{%- endif -%}
{%- if station_obj == nil and lopik != nil -%}
  {%- for s in stations -%}
    {%- if s.stationname == lopik.stationname -%}
      {%- assign station_obj = s -%}
      {%- break -%}
    {%- endif -%}
  {%- endfor -%}
{%- endif -%}

{%- assign _lat = '' -%}
{%- assign _lon = '' -%}

{%- if use_coords and has_user_coords -%}
  {# Use the *string* inputs to preserve decimals #}
  {%- assign _lat = lat_raw -%}
  {%- assign _lon = lon_raw -%}
{%- elsif station_obj != nil -%}
  {%- assign _lat = station_obj.lat -%}
  {%- assign _lon = station_obj.lon -%}
{%- endif -%}

{%- comment -%}Fallbacks: try any coords on lopik{%- endcomment -%}
{%- if _lat == '' and lopik != nil -%}
  {%- assign _lat = lopik.lat | default: lopik.latitude | default: lopik.geo_lat -%}
{%- endif -%}
{%- if _lon == '' and lopik != nil -%}
  {%- assign _lon = lopik.lon | default: lopik.lng | default: lopik.longitude | default: lopik.geo_lng -%}
{%- endif -%}

{%- comment -%}Hard fallback (Lopik-Cabauw-ish){%- endcomment -%}
{%- if _lat == '' -%}{%- assign _lat = '51.97' -%}{%- endif -%}
{%- if _lon == '' -%}{%- assign _lon = '4.93' -%}{%- endif -%}
<style>
  /* Constrain the overall page size */
  /*body {
    margin: 0;
    padding: 0;
    font-family: Arial, sans-serif;
    font-size: 14px;
    box-sizing: border-box;
  }*/

  /* Use flex layout for container */
  .{{ prefix }}_container {
    display: flex;
    flex-direction: row;
    align-items: flex-start;  /* top-align content */
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    padding: 5px;
  }

  /* Forecast area on the left */
  .{{ prefix }}_forecast-area {
    flex: 1;                
    min-width: 0;           
    margin-right: 10px;     
  }

  /* Radar on the right */
  .{{ prefix }}_radar {
    width: 400px;
    flex-shrink: 0; /* keep radar at 240px width */
  }
  .{{ prefix }}_radar img {
    display: block;
    max-width: 100%;
    height: auto;

    /* Example filters to alter color/contrast: */
    filter:  saturate(150%) invert(30%) hue-rotate(155deg) saturate(80%) contrast(25) brightness(2) hue-rotate(50deg) grayscale(1);
    mix-blend-mode: multiply; 
  }

  /* Minimal styling for "Now" block */
  .{{ prefix }}_now {
    margin-bottom: 8px;
    border: 1px solid black;
    padding: 5px;
  }

  /* Forecast Table (row=property, col=days) */
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 8px;
  }
  table, th, td {
    border: 1px solid black;
  }
  th, td {
    padding: 4px;
    text-align: center;
  }
  th:first-child, td:first-child {
    text-align: left; /* left-align the property name */
  }

  /* Summaries & descriptions */
  .{{ prefix }}_description-block {
    margin-bottom: 8px;
    font-size: 13px;
    line-height: 1.3;
  }
  .{{ prefix }}_summary {
    font-size: 12px;
    line-height: 1.4;
  }
</style>

<div class="{{ prefix }}_container">
  <!-- Left side: Current Weather + Forecast + Summaries -->
  <div class="{{ prefix }}_forecast-area">


    <div class="{{ prefix }}_now">
      <strong>Temperatuur</strong>: {{ lopik.temperature }} °C (gevoel {{ lopik.feeltemperature }} °C)<br/>
      <strong>Weer</strong>: {{ lopik.weatherdescription }} ({{ lopik.sunpower }} zon-index)<br/>
      <strong>Wind</strong>: {{ lopik.windspeed }} m/s (Bft {{ lopik.windspeedBft }}), <strong>richting</strong> {{ lopik.winddirection }}<br/>
      <strong>Neerslag</strong>: {{ lopik.precipitation }} ({{ lopik.rainFallLastHour}}/h) <strong>Luchtvochtigheid</strong>: {{ lopik.humidity }}%
    </div>

    {% if view_mode == 'raingraph' %}
      <!-- 2-hour rain graph (replaces the table) -->
<div class="{{ prefix }}_rain-graph" style="margin-bottom:8px">
  <div style="font-weight:bold;margin-bottom:4px">
    Neerslag (komende 2 uur) — {{ lopik.stationname }}
  </div>

  <div style="position:relative;width:100%;height:140px;border:1px solid #000;background:#fff">
    <svg id="precip-chart" viewBox="0 0 360 120" preserveAspectRatio="none"
         style="position:absolute;left:0;top:0;width:100%;height:120px"></svg>

    <!-- Right-side vertical labels -->
    <div style="position:absolute;right:20px;top:6px;font-size:12px;writing-mode:vertical-rl;transform:rotate(270deg);">Zwaar</div>
    <div style="position:absolute;right:20px;bottom:26px;font-size:12px;writing-mode:vertical-rl;transform:rotate(270deg);">Licht</div>

    <!-- Bottom axis labels (times) -->
    <div id="precip-times"
         style="position:absolute;left:0;right:0;bottom:2px;height:18px;
                display:flex;justify-content:space-between;font-size:12px;"></div>
  </div>
</div>

<script>
(function(){
  // --- coords (tolerate commas & swapped fields) ---
  const rawLat='{{ _lat | default: "52.0" }}'.replace(',', '.').trim();
  const rawLon='{{ _lon | default: "4.9" }}'.replace(',', '.').trim();
  let lat = parseFloat(rawLat), lon = parseFloat(rawLon);
  if (!isFinite(lat) || !isFinite(lon)) { lat=51.97; lon=4.93; }
  if (Math.abs(lat) < 15 && Math.abs(lon) > 20) { const t=lat; lat=lon; lon=t; }

  const W=360, H=120, PAD=6;
  const svg=document.getElementById('precip-chart');
  const timesEl=document.getElementById('precip-times');
  const NS=svg.namespaceURI;
  const log10 = Math.log10 ? Math.log10 : (x)=>Math.log(x)/Math.LN10;

  // code → mm/h (Buienradar)
  const toMMh = c => { const n=parseInt(c,10); return isNaN(n)?0:Math.pow(10,(n-109)/32); };
  const timeToMin=t=>{ const [hh,mm]=t.split(':').map(Number); return hh*60+mm; };
  const minToTime=m=>{ const hh=Math.floor(((m%1440)+1440)%1440/60), mm=((m%60)+60)%60;
                       return `${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}`; };

  // ---- visual mapping like Buienradar ----
  const V0 = 0.05;  // floor: light rain still visible
  const V1 = 4.0;   // cap: keeps peaks from hitting "Zwaar"
  function visY(v){ // returns 0..1 (0 = bottom, 1 = top)
    const num  = log10(v + V0) - log10(V0);
    const denom= log10(V1 + V0) - log10(V0);
    return Math.max(0, Math.min(1, num / (denom || 1)));
  }

  // Optional: tiny smoothing to reduce 1-sample spikes
  function smooth(series){
    const out = series.slice();
    for (let i=1;i<series.length-1;i++){
      out[i].mmh = (series[i-1].mmh + 2*series[i].mmh + series[i+1].mmh)/4;
    }
    return out;
  }

  function drawFrame(series, labelXs){
    while (svg.firstChild) svg.removeChild(svg.firstChild);

    // grid
    for (let i=0;i<=5;i++){
      const y=PAD+i*(H-PAD*2)/5;
      const ln=document.createElementNS(NS,'line');
      ln.setAttribute('x1',PAD); ln.setAttribute('x2',W-PAD);
      ln.setAttribute('y1',y);   ln.setAttribute('y2',y);
      ln.setAttribute('stroke','#000'); ln.setAttribute('opacity','0.20');
      svg.appendChild(ln);
    }
    labelXs.forEach(x=>{
      const ln=document.createElementNS(NS,'line');
      ln.setAttribute('x1',x); ln.setAttribute('x2',x);
      ln.setAttribute('y1',PAD); ln.setAttribute('y2',H-PAD);
      ln.setAttribute('stroke','#000'); ln.setAttribute('opacity','0.2');
      svg.appendChild(ln);
    });

    // "Nu"
    const tick=document.createElementNS(NS,'line');
    tick.setAttribute('x1',PAD+1); tick.setAttribute('x2',PAD+1);
    tick.setAttribute('y1',PAD);   tick.setAttribute('y2',H-PAD);
    tick.setAttribute('stroke','#000'); tick.setAttribute('stroke-width','1');
    svg.appendChild(tick);
    const nu=document.createElementNS(NS,'text');
    nu.textContent='Nu'; nu.setAttribute('x',PAD+3); nu.setAttribute('y',14);
    nu.setAttribute('font-size','12'); nu.setAttribute('font-weight','700');
    svg.appendChild(nu);

    if (!series || !series.length) return;

    const hasRain = series.some(d=>d.mmh>0);
    if (!hasRain){
      const base=document.createElementNS(NS,'line');
      base.setAttribute('x1',PAD); base.setAttribute('x2',W-PAD);
      base.setAttribute('y1',H-PAD-1); base.setAttribute('y2',H-PAD-1);
      base.setAttribute('stroke','#000'); base.setAttribute('stroke-width','1');
      base.setAttribute('opacity','0.8'); svg.appendChild(base);
      return;
    }

    const sx=(W-PAD*2)/(series.length-1);
    let dA=`M ${PAD},${H-PAD}`;
    let dL=`M ${PAD},${H-PAD}`;
    series.forEach((d,i)=>{
      const x = PAD + i*sx;
      const intensity = visY(d.mmh);           // 0..1
      const y = H - PAD - intensity * 0.7 *   // 0.85 lowers the whole curve a bit
                (H - PAD*2);
      dA += ` L ${x.toFixed(1)},${y.toFixed(1)}`;
      dL += ` L ${x.toFixed(1)},${y.toFixed(1)}`;
    });
    dA += ` L ${W-PAD},${H-PAD} Z`;

    const area=document.createElementNS(NS,'path');
    area.setAttribute('d',dA);
    area.setAttribute('fill','#000');
    area.setAttribute('opacity','0.60');  // darker fill
    svg.appendChild(area);

    const line=document.createElementNS(NS,'path');
    line.setAttribute('d',dL);
    line.setAttribute('fill','none');
    line.setAttribute('stroke','#000');
    line.setAttribute('stroke-width','1.6');
    svg.appendChild(line);
  }

  function layoutTimeAxis(firstT,lastT){
    const first=timeToMin(firstT), last=timeToMin(lastT);
    const start = first + ((30 - (first % 30)) % 30);
    const labels=[]; for (let m=start; m<=last; m+=30) labels.push(minToTime(m));

    timesEl.innerHTML=''; const xs=[];
    if (labels.length){
      const total = last - first || 120;
      labels.forEach(lbl=>{
        const pos=(timeToMin(lbl)-first)/total;
        const x=PAD + pos*(W - PAD*2);
        xs.push(x);
        const span=document.createElement('span');
        span.textContent=lbl;
        span.style.position='absolute';
        span.style.left=`calc(${(x/W)*100}% - 16px)`;
        span.style.bottom='0';
        timesEl.appendChild(span);
      });
    }
    return xs;
  }

  function build(series){
    if (!series.length){ drawFrame(null, []); return; }
    // Uncomment to enable smoothing if you want:
    // series = smooth(series);
    const xs = layoutTimeAxis(series[0].t, series[series.length-1].t);
    drawFrame(series, xs);
  }

  const url=`https://gpsgadget.buienradar.nl/data/raintext?lat=${lat.toFixed(4)}&lon=${lon.toFixed(4)}&t=${Date.now()}`;
  fetch(url,{cache:'no-store'})
    .then(r=>r.ok?r.text():Promise.reject(r.status))
    .then(text=>{
      const lines=(text||'').trim().split('\n').filter(Boolean);
      const series = lines.map(line=>{
        const [code,time] = line.split('|');
        return { t: time, mmh: toMMh(code) };
      });
      build(series);
    })
    .catch(()=>{
      const now=new Date(); const m5=Math.ceil(now.getMinutes()/5)*5;
      const start=new Date(now.getFullYear(),now.getMonth(),now.getDate(),now.getHours(),m5,0);
      const series=[];
      for(let i=0;i<24;i++){
        const t=new Date(start.getTime()+i*5*60000);
        const hh=String(t.getHours()).padStart(2,'0');
        const mm=String(t.getMinutes()).padStart(2,'0');
        series.push({ t:`${hh}:${mm}`, mmh:0 });
      }
      build(series);
    });
})();
</script>

    {% else %}

    
    <!-- 5-Day Forecast: row=property, col=days -->
    <table>
      <thead>
        <tr>
          <th></th>
          <!-- Loop 5 days for the headers -->
          {% for i in (0..4) %}
          <th>
            {{ forecast.fivedayforecast[i].day | date: "%a" }}
          </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        <!-- Row: Max Temp -->
        <tr>
          <td>Max Temp (°C)</td>
          {% for i in (0..4) %}
          <td>{{ forecast.fivedayforecast[i].maxtemperature }}</td>
          {% endfor %}
        </tr>
        <!-- Row: Min Temp -->
        <tr>
          <td>Min Temp (°C)</td>
          {% for i in (0..4) %}
          <td>{{ forecast.fivedayforecast[i].mintemperature }}</td>
          {% endfor %}
        </tr>
        <!-- Row: Rain (%) -->
        <tr>
          <td>Regen (%)</td>
          {% for i in (0..4) %}
          <td>{{ forecast.fivedayforecast[i].rainChance }}%</td>
          {% endfor %}
        </tr>
        <!-- Row: Rain Min (mm) -->
        <tr>
          <td>Min Regen (mm)</td>
          {% for i in (0..4) %}
          <td>{{ forecast.fivedayforecast[i].mmRainMin }}</td>
          {% endfor %}
        </tr>
        <!-- Row: Rain Max (mm) -->
        <tr>
          <td>Max Regen (mm)</td>
          {% for i in (0..4) %}
          <td>{{ forecast.fivedayforecast[i].mmRainMax }}</td>
          {% endfor %}
        </tr>
      </tbody>
    </table>
    {% endif %}

    <!-- Today & Tomorrow Descriptions -->
    <div class="{{ prefix }}_description-block">
      <strong>Vandaag:</strong> {{ forecast.fivedayforecast[0].weatherdescription }}<br/>
      <strong>Morgen:</strong> {{ forecast.fivedayforecast[1].weatherdescription }}
    </div>

    <!-- Short-Term Summary -->
    <div class="{{ prefix }}_summary">
      <strong>Voorspelling:</strong><br/>
      {{ forecast.shortterm.forecast }}
    </div>
  </div>

  <!-- Right side: Radar image -->
  <div class="{{ prefix }}_radar">
    <img 
      src="https://image.buienradar.nl/2.0/image/single/RadarMapRainNL?height=512&amp;width=512&amp;renderBackground=True&amp;renderBranding=False&amp;renderText=True" 
      alt="Radar"
      >
  </div>
</div>